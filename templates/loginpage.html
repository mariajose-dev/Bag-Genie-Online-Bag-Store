<!DOCTYPE html>
<html lang="en">
<head>
    {% include "partials/head.html" %}
    <style>
        body {
            background: url('/static/images/wallpapperloginpage.jpeg') no-repeat center center;
            background-size: cover;
        }
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        form {
            background: #bda7de;
            padding: 20px;
            border-radius: 10px;
            /*box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);*/
            width: 300px;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid black;
            border-radius: 5px;
            background: #bda7de;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .error {
            color: red;
            font-size: 0.9em;
        }
        .success {
            color: green;
            font-size: 0.9em;
        }
        .toggle-password {
            position: absolute;
            right: 15px;
            top: 70%;
            transform: translateY(-50%);
            cursor: pointer;
        }
        .password-container {
            position: relative;
            width: 100%;
        }
        .signup-text {
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
            color: #333;
        }
        .signup-link {
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s ease-in-out;
        }
        .signup-link:hover {
            color: green;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #bda7de;
            padding: 20px;
            border-radius: 10px;
            
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            font-weight: bold;
        }
        .close-modal:hover {
            color: #ff0000; /* Red on hover for visual feedback */
        }
    </style>
    <script>
        function togglePassword(fieldId) {
            var passwordField = document.getElementById(fieldId);
            if (passwordField.type === "password") {
                passwordField.type = "text";
            } else {
                passwordField.type = "password";
            }
        }
    </script>
</head>
<body>
    {% include "partials/header.html" %}
    <br><br><br><br><br><br>
    <div class="container">
        <form method="POST" action="/loginpage">
            <h2><center>Login</center></h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
            {% endwith %}
        
            <label for="username">Email (Username):</label>
            <input type="email" id="username" name="username" required>

            <div class="password-container">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
                <span class="toggle-password" onclick="togglePassword('password')">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368">
                        <path d="M480.18-311Q559-311 614-366.18q55-55.17 55-134Q669-579 613.82-634q-55.17-55-134-55Q401-689 346-633.82q-55 55.17-55 134Q291-421 346.18-366q55.17 55 134 55Zm-.12-101q-36.64 0-62.35-25.65T392-499.94q0-36.64 25.65-62.35T479.94-588q36.64 0 62.35 25.65T568-500.06q0 36.64-25.65 62.35T480.06-412ZM480-157q-163 0-294.5-95T-5-500q59-153 190.5-248T480-843q163 0 294.5 95T965-500q-59 153-190.5 248T480-157Zm0-343Zm.09 222q112.91 0 207.2-60.54Q781.58-399.08 832-500q-50.42-100.92-144.8-161.46Q592.82-722 479.91-722t-207.2 60.54Q178.42-600.92 128-500q50.42 100.92 144.8 161.46Q367.18-278 480.09-278Z"/>
                    </svg>
                </span>
            </div>

            <button type="submit">Login</button>
            <p class="signup-text">
                New User? <a href="/signupauthen" class="signup-link">Sign Up</a> | 
                <a href="/forgot_password" class="signup-link">Forgot Password?</a>
            </p>
        </form>

<!-- Forgot Password Modal (Rendered conditionally) -->
{% if show_forgot_password %}
<div class="modal" style="display: flex;">
    <div class="modal-content">
        <a href="/loginpage" class="close-modal">Ã—</a> <!-- Close symbol -->
        <!-- Store flashed messages once at the top of the modal -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if not security_question_shown and not password_reset_shown %}
        <!-- Step 1: Enter Email -->
        <form method="POST" action="/forgot_password">
            <h2><center>Forgot Password</center></h2>
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
            <label for="forgot-username">Enter your Email ID:</label>
            <input type="email" id="forgot-username" name="forgot-username" value="{{ username|default('') }}" required oninput="this.value = this.value.toLowerCase();">

            <button type="submit" name="step" value="check_email">Next</button>
        </form>
        {% elif security_question_shown and not password_reset_shown %}
        <!-- Step 2: Security Question -->
        <form method="POST" action="/forgot_password">
            <h2><center>Forgot Password</center></h2>
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
            <input type="hidden" name="username" value="{{ username }}">
            <label>What is your Favorite Food?</label>
            <input type="text" id="security-answer" name="security-answer" required>
            <button type="submit" name="step" value="check_answer">Next</button>
        </form>
        {% elif password_reset_shown %}
        <!-- Step 3: Reset Password -->
        <form method="POST" action="/forgot_password">
            <h2><center>Reset Password</center></h2>
            {% if messages %}
                {% for category, message in messages %}
                    <div class="{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
            <input type="hidden" name="username" value="{{ username }}">
            <div class="password-container">
                <label for="new-password">New Password:</label>
                <input type="password" id="new-password" name="new-password" required>
                <span class="toggle-password" onclick="togglePassword('new-password')">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#5f6368">
                        <path d="M480.18-311Q559-311 614-366.18q55-55.17 55-134Q669-579 613.82-634q-55.17-55-134-55Q401-689 346-633.82q-55 55.17-55 134Q291-421 346.18-366q55.17 55 134 55Zm-.12-101q-36.64 0-62.35-25.65T392-499.94q0-36.64 25.65-62.35T479.94-588q36.64 0 62.35 25.65T568-500.06q0 36.64-25.65 62.35T480.06-412ZM480-157q-163 0-294.5-95T-5-500q59-153 190.5-248T480-843q163 0 294.5 95T965-500q-59 153-190.5 248T480-157Zm0-343Zm.09 222q112.91 0 207.2-60.54Q781.58-399.08 832-500q-50.42-100.92-144.8-161.46Q592.82-722 479.91-722t-207.2 60.54Q178.42-600.92 128-500q50.42 100.92 144.8 161.46Q367.18-278 480.09-278Z"/>
                    </svg>
                </span>
            </div>
            <div class="password-container">
                <label for="confirm-password">Confirm New Password:</label>
                <input type="password" id="confirm-password" name="confirm-password" required>
                <span class="toggle-password" onclick="togglePassword('confirm-password')">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0-960 960 960" width="24px" fill="#5f6368">
                        <path d="M480.18-311Q559-311 614-366.18q55-55.17 55-134Q669-579 613.82-634q-55.17-55-134-55Q401-689 346-633.82q-55 55.17-55 134Q291-421 346.18-366q55.17 55 134 55Zm-.12-101q-36.64 0-62.35-25.65T392-499.94q0-36.64 25.65-62.35T479.94-588q36.64 0 62.35 25.65T568-500.06q0 36.64-25.65 62.35T480.06-412ZM480-157q-163 0-294.5-95T-5-500q59-153 190.5-248T480-843q163 0 294.5 95T965-500q-59 153-190.5 248T480-157Zm0-343Zm.09 222q112.91 0 207.2-60.54Q781.58-399.08 832-500q-50.42-100.92-144.8-161.46Q592.82-722 479.91-722t-207.2 60.54Q178.42-600.92 128-500q50.42 100.92 144.8 161.46Q367.18-278 480.09-278Z"/>
                    </svg>
                </span>
            </div>
            <button type="submit" name="step" value="update_password">Update Password</button>
        </form>
        {% endif %}
        {% endwith %}
    </div>
</div>
{% endif %}
    </div>
    <br><br><br><br><br>
    {% include "partials/footer.html" %}
</body>
</html>